<!doctype html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="always">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="google-site-verification" content="m9HzlxEFMjeLY1dz5g98y0-93U1BVLaGlv_D4c984PI"/>
    <link rel="profile" href="http://gmpg.org/xfn/11"/>

    
    <title>Run Elasticsearch by docker | zo9n</title>

    <meta name="description" content="This is a salted fish coder developed website which mainly records and shares coding notes, random thoughts."/>
    <meta name="keywords" content="tech,elasticsearch"/>
    
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Run Elasticsearch by docker"/>



    <meta property="og:locale" content="zh-Hans">

    <link href="https://fonts.googlefonts.cn/css?family=Merriweather+Sans" rel="stylesheet">

    
    <link href="https://fonts.googleapis.cn/css2?family=Noto+Serif&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/static/css/style.css" type="text/css">
    <link rel="stylesheet" href="/static/css/code.css" type="text/css">
    
</head>

<body data-new-gr-c-s-check-loaded="14.991.0">

<nav>
    <div class="site-name nav">
        <span><a href="/">zo9n</a></span>
    </div>
    
    <div class="menu nav">
        <ul class="menu">
            <li><a href="/">Home</a></li>
            <li><a href="/about.html">About</a></li>
            <li><a href="/tags.html">Tags</a></li>
            <li><a href="/links.html">Links</a></li>

        </ul>
    </div>


    
    
    
    
    
    
    <hr>
</nav>



<main>
    
    <div class="article-meta">
        <h1 class="title">Run Elasticsearch by docker</h1>
        <div class="article-attrs">
            <span class="author"><a href="/about.html">@zo9n</a></span>
            <span class="date"><time>2021-04-30</time></span>
        </div>
    </div>

    <div class="article-body">
        **1. Download the docker image of Elasticsearch, taking version 7.6.0 as an example**

```bash
	docker pull elasticsearch:7.6.0
```

**2. Create a container and run it.**

if your command is:


```bash
   docker run -d --name es -p 9200:9200 -p 9300:9300 elasticsearch:7.6.0
```
It may exit shortly after starting. To find out the reason, view logs by log command:

```bash
   docker logs es
```
Some error message like ``max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]`` may appear. Go the following command:

```bash
   # change the variable
   sysctl -w vm.max_map_count=262144
   # check the variable value
   sysctl -n vm.max_map_count
```

If the error message is ``the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured``, which means the container has wrong configuration and can be corrected by setting those prompted environment variables or setting to standalone development mode by ``discovery.type=single-node``.

   In short, the correct command is:

```bash
   docker run -d --name es -p 9200:9200 -p 9300:9300 -e discovery.type=single-node elasticsearch:7.6.0
```

## Using IK Chinese segmentation plugin.

**1. Download the plugin.**

The plugin version must equal the Elasticsearch version. Version 7.6.0 download link is <https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.0/elasticsearch-analysis-ik-7.6.0.zip>。

**2. Unzip to an empty directory, which is referred to as  *`$IK`***.

**3. Copy the *`$IK`* into the directory of the container's plugin.**

```bash
   docker cp $IK es:/usr/share/elasticsearch/plugins/ik
```

This plugin provides analyzer and tokenizer named `ik_smart` and `ik_max_word` where `ik_smart` splits by the coarsest granularity, while `ik_max_word` will exhaust all kinds of split combinations.

Find more info at [IK](https://github.com/medcl/elasticsearch-analysis-ik).
    </div>

    <script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="dns-prefetch" href="//cdn.mathjax.org"/>
    <script src="/static/js/math.js"></script>

</main>

<footer>
    <hr/>
    &copy; 2020-2022 · <a href="/about.html">zo9n</a>
    
    
    
</footer>


</body>
</html>